<html>
    <head>
        <title>CrypTax</title>
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
            rel="stylesheet"
            crossorigin="anonymous">
        <link href="./public/style.css" rel="stylesheet">
    </head>
    <body>
        <h2>{{ header }}</h2>
        <h4>Report criptovalute anno {{ fiscal_year }}</h4>

        <table class='table table-bordered table-sm'>
            <tr>
                <th colspan='2'>Criptovaluta</th>
                <th colspan='2'>Prezzo 01/01/{{ fiscal_year }} <sub>1)</sub></th>
                <th colspan='2'>Prezzo 31/12/{{ fiscal_year }} <sub>2)</sub></th>
                <th colspan='2'>Saldo 01/01/{{ fiscal_year }}</th>
                <th colspan='2'>Controvalore 01/01/{{ fiscal_year }}</th>
                <th colspan='2'>Saldo 31/12/{{ fiscal_year }}</th>
                <th colspan='2'>Controvalore 31/12/{{ fiscal_year }}</th>
                <th colspan='2'>Giacenza media <sub>3)</sub></th>
                <th colspan='2'>Valore massimo <sub>3)</sub></th>
            </tr>

            {% for crypto in crypto_info %}
                    <tr>
                        <td><b>{{ crypto['name'] }}</b></td>
                        <td><b>{{ crypto['ticker'] }}</b></td>
                        <td class='price'>{{ crypto['price_start_of_year'] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ crypto['price_end_of_year'] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ crypto['balance_start_of_year'] }}</td>
                        <td class='unit'>¤</td>
                        <td class='price'>{{ crypto['value_start_of_year'] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ crypto['balance_end_of_year'] }}</td>
                        <td class='unit'>¤</td>
                        <td class='price'>{{ crypto['value_end_of_year'] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ crypto['average_value'] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ crypto['max_value'] }}</td>
                        <td class='unit'>€</td>
                    </tr>
            {% endfor %}

            <tr>
                <td colspan='2'><b>TOTALE</b></td>
                <td class='price' colspan='2'>n.a.</td>
                <td class='price' colspan='2'>n.a.</td>
                <td class='price' colspan='2'>n.a.</td>
                <td class='price'><b>{{ summary['total_values']['value_start_of_year'] }}</b></td>
                <td class='unit'><b>€</b></td>
                <td class='price' colspan='2'>n.a.</td>
                <td class='price'><b>{{ summary['total_values']['value_end_of_year'] }}</b></td>
                <td class='unit'><b>€</b></td>
                <td class='price'><b>{{ summary['total_values']['average_value'] }}</b></td>
                <td class='unit'><b>€</b></td>
                <td class='price'><b>{{ summary['total_values']['max_value'] }}</b></td>
                <td class='unit'><b>€</b></td>
            </tr>
        </table>

        <div class="pagebreak"> </div>

        <div class="column leftColumn">
            <table class='table table-bordered table-sm' style="max-width: 620px; margin: 0 auto;">
                <tr>
                    <th colspan='8'>Guadagni</th>
                </tr>
                <tr>
                    <th colspan='1' rowspan='2'>Tipologia</th>
                    <th colspan='4'>Realizzati </th>
                    <th colspan='2' rowspan='2'>Non realizzati <sub>6)</sub></th>
                </tr>
                <tr>
                    <th colspan='2'>anni precedenti <sub>5)</sub></th>
                    <th colspan='2'>anno corrente</th>
                </tr>
                <tr>
                    <td>Plusvalenze</td>
                    <td class='price' colspan='2'>n.a.</td>
                    <td class='price'>{{ earnings['capital_gains']}} </td>
                    <td class='unit'>€</td><td class='price' colspan='2'>n.a.</td>
                </tr>

                {% for category, exchanges in detailed_earnings %}
                    <tr>
                        <td>{{ earnings_categories[category] | capitalize }}</td>
                        <td class='price'>{{ earnings['rap'][category] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ earnings['rac'][category] }}</td>
                        <td class='unit'>€</td>
                        <td class='price'>{{ earnings['nr'][category] }}</td>
                        <td class='unit'>€</td>
                    </tr>
                {% endfor %}
            </table>

            {% for category, exchanges in detailed_earnings %}
                <table class='table table-bordered table-sm' style="max-width: 620px; margin: 0 auto; margin-top: 16px;">
                    <tr>
                        <th colspan='8'>Dettaglio {{ earnings_categories[category] }}</th>
                    </tr>
                    <tr>
                        <th colspan='1' rowspan='2'>Provenienza</th>
                        <th colspan='4'>Realizzati </th>
                        <th colspan='2' rowspan='2'>Non realizzati <sub>6)</sub></th>
                    </tr>
                    <tr>
                        <th colspan='2'>anni precedenti <sub>5)</sub></th>
                        <th colspan='2'>anno corrente</th>
                    </tr>

                    {% for exchange, values in exchanges %}
                        <tr>
                            <td>{{ exchange }}</td>
                            <td class='price'>{{ values['rap'] }}</td>
                            <td class='unit'>€</td>
                            <td class='price'>{{ values['rac'] }}</td>
                            <td class='unit'>€</td>
                            <td class='price'>{{ values['nr'] }}</td>
                            <td class='unit'>€</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endfor %}
        </div>

        <div class="column rightColumn">
            <table class="table table-bordered table-sm" style="max-width: 460px; margin: 0 auto;">
                <tr>
                    <th style="text-align: left">Investimenti anno corrente <sub>4)</sub></th>
                    <td class='price'>{{ summary['current_year_investment'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th colspan="3"></th>
                </tr>
                <tr>
                    <th style="text-align: left">Totale dei corrispettivi <sub>RT21</sub></th>
                    <td class='price'>{{ summary['current_year_income'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Totale dei costi o dei valori di acquisto <sub>RT22</sub></th>
                    <td class='price'>{{ summary['current_year_purchase_cost'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Plusvalenze</th>
                    <td class='price'>{{ summary['capital_gains'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Plusvalenze + airdrop <sub>RT23</sub> <sub>7)</sub></th>
                    <td class='price'>{{ summary['capital_gains_and_airdrop'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Imposta sostitutiva <sub>RT27</sub></th>
                    <td class='price'>{{ summary['capital_gains_tax'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Superata soglia 51.645,69 €</th>
                    <td style="text-align: center" colspan='2'>{{ summary['no_tax_area_threshold_exceeded'] ? 'sì' : 'no' }}</td>
                </tr>
                <tr><th colspan="3"></th></tr>
                <tr>
                    <th style="text-align: left">Redditi di capitale <sub>RM12.3</sub> <sub>8)</sub></th>
                    <td class='price'>{{ summary['interests'] }}</td>
                    <td class='unit'>€</td>
                </tr>
                <tr>
                    <th style="text-align: left">Imposta sostitutiva <sub>RM12.6</sub></th>
                    <td class='price'>{{ summary['interests_tax'] }}</td>
                    <td class='unit'>€</td>
                </tr>
            </table>

            <div class="chart" style="width: 99%; height: 400px; margin-top: 30px;">
                <canvas id="chart2" width="100%" height="100%"></canvas>
            </div>
        </div>

        <div style="float: none; clear: both" />

        <div class="chart half left" style="width: 100%; height: 400px; margin-top: 8px; margin-bottom: 16px;">
            <canvas id="chart1" width="100%" height="100%"></canvas>
        </div>

        <p>
            1) fonte: cryptohistory.one<br />
            nei casi dove non è disponibile il prezzo al giorno 01/01/{{ fiscal_year }} è indicato il primo prezzo disponibile nell'anno {{ fiscal_year }}
        </p>
        <p>
            2) fonte: cryptohistory.one
        </p>
        <p>
            3) calcolato secondo il prezzo al giorno 31/12/{{ fiscal_year }}
        </p>
        <p>
            4) somma dei costi d'acquisto - somma dei corrispettivi di cessione
        </p>
        <p>
            5) guadagni percepiti negli anni precedenti, ma venduti ovvero scambiati con un'altra criptovaluta nell'anno corrente
        </p>
        <p>
            6) guadagni percepiti nell'anno corrente che non sono ancora stati venduti ovvero scambiati con un'altra criptovaluta
        </p>
        <p>
            7) somma delle plusvalenze e degli airdrop ricevuti nell'anno corrente, realizzati e non realizzati
        </p>
        <p>
            8) interessi ricevuti nell'anno corrente, realizzati e non realizzati
        </p>

        <script>
            const fiscalYear = {{ fiscal_year }};
            const daysList = {{ days_list | json_encode | raw }};
            const dailyTotalValuesLegal = {{ daily_values_start_of_year | json_encode | raw }};
            const dailyTotalValuesEOY = {{ daily_values_end_of_year | json_encode | raw }};
            const dailyTotalValuesReal = {{ daily_values_real | json_encode | raw }};
            const exchanges = {{ exchange_volumes | keys | json_encode | raw }};
            const exchangeVolumes = Object.values({{ exchange_volumes | json_encode | raw }});
        </script>

        <script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js" integrity="sha256-t9UJPrESBeG2ojKTIcFLPGF7nHi2vEc7f5A2KpH/UBU=" crossorigin="anonymous"></script>
        <script src="https://google.github.io/palette.js/palette.js" integrity="sha256-5f158MWiiHKxtoGF9P+WFLMLh3bMthtMx58ayBvTF38=" crossorigin="anonymous"></script>
        <script src="./public/script.js"></script>
    </body>
</html>
